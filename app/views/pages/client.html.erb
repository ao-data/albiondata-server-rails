<div class="page client-page">
  <header class="site-header">
    <div class="site-header__inner">
      <h1 class="site-title"><%= link_to "The Albion Online Data Project", root_path %></h1>
      <p class="site-tagline">Realtime market and gold data for Albion Online</p>
      <%= render "nav", current: :client %>
    </div>
  </header>

  <div class="disclaimer banner">
    <p><strong>These tools are not affiliated with Albion Online or Sandbox Interactive GmbH.</strong></p>
  </div>

  <main class="main-content">
    <h2 class="page-title">Client</h2>
    <p class="lead">The Albion Data client runs on your machine while you play Albion Online and uploads market and gold price data to the project.</p>

    <section class="content-section client-download-section">
      <h2>Get the client</h2>
      <p class="client-download-intro">Download the client and run it whenever you play. The client uploads market orders from the markets you open in game.</p>
      <div class="client-download-cta">
        <a href="https://github.com/ao-data/albiondata-client/releases" class="btn btn--primary" target="_blank" rel="noopener">Download the client</a>
      </div>
      <% if @client_download_stats && @client_download_stats.error.nil? %>
        <div class="client-stats">
          <p class="client-stats__intro">Live download stats from GitHub</p>
          <div class="client-stats__panels">
            <% if @client_download_stats.latest_release_tag.present? %>
              <div class="client-stats__panel">
                <h4 class="client-stats__panel-title">Latest release (<%= @client_download_stats.latest_release_tag %>)</h4>
                <p class="client-stats__panel-total"><%= number_with_delimiter(@client_download_stats.latest_release_downloads) %></p>
                <% if @client_download_stats.latest_downloads_by_os.present? %>
                  <div class="client-stats__row">
                    <span class="client-stats__label">Platform</span>
                    <span class="client-stats__pills">
                      <% %w[Windows macOS Linux Other].each do |key| %>
                        <% count = @client_download_stats.latest_downloads_by_os[key].to_i %>
                        <% if count > 0 %>
                          <span class="client-stats__pill"><%= key %> <%= number_with_delimiter(count) %></span>
                        <% end %>
                      <% end %>
                    </span>
                  </div>
                <% end %>
                <% if @client_download_stats.latest_downloads_by_type.present? %>
                  <div class="client-stats__row">
                    <span class="client-stats__label">Type</span>
                    <span class="client-stats__pills">
                      <% @client_download_stats.latest_downloads_by_type.sort_by { |_, v| -v }.each do |label, count| %>
                        <span class="client-stats__pill"><%= label %> <%= number_with_delimiter(count) %></span>
                      <% end %>
                    </span>
                  </div>
                <% end %>
              </div>
            <% end %>
            <div class="client-stats__panel">
              <h4 class="client-stats__panel-title">All releases</h4>
              <p class="client-stats__panel-total"><%= number_with_delimiter(@client_download_stats.total_downloads) %></p>
              <% if @client_download_stats.downloads_by_os.present? %>
                <div class="client-stats__row">
                  <span class="client-stats__label">Platform</span>
                  <span class="client-stats__pills">
                    <% %w[Windows macOS Linux Other].each do |key| %>
                      <% count = @client_download_stats.downloads_by_os[key].to_i %>
                      <% if count > 0 %>
                        <span class="client-stats__pill"><%= key %> <%= number_with_delimiter(count) %></span>
                      <% end %>
                    <% end %>
                  </span>
                </div>
              <% end %>
              <% if @client_download_stats.downloads_by_type.present? %>
                <div class="client-stats__row">
                  <span class="client-stats__label">Type</span>
                  <span class="client-stats__pills">
                    <% @client_download_stats.downloads_by_type.sort_by { |_, v| -v }.each do |label, count| %>
                      <span class="client-stats__pill"><%= label %> <%= number_with_delimiter(count) %></span>
                    <% end %>
                  </span>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </section>

    <section class="content-section">
      <h2>Command line options</h2>
      <p>To see all available command line parameters, launch the executable with <code>-h</code>, for example:</p>
      <p><code class="client-cmd">"C:\Program Files\Albion Data Client\albiondata-client.exe" -h</code></p>
      <p>Or add <code>-h</code> to your shortcut. Current options include:</p>
      <pre class="client-pre"><code>-d                    If specified no attempts will be made to upload data to remote server.
-debug                 Enable debug logging.
-events string         Whitelist of event IDs to output when debugging. Comma separated.
-events-ignore string  Blacklist of event IDs to hide when debugging. Comma separated.
-i string              Base URL to send PUBLIC data to ('nats://', 'http://' or 'noop', comma separated).
                       Default: http+pow://pow.west.albion-online-data.com or pow.east (by game server).
-ignore-decode-errors  Ignore decoding errors when debugging.
-l string              Listen on this comma-separated device list instead of all available.
-minimize              Automatically minimize the window.
-no-limit              Use all available CPU cores.
-o string              Parse a local file instead of checking Albion ports.
-operations string     Whitelist of operation IDs when debugging. Comma separated.
-operations-ignore string  Blacklist of operation IDs when debugging. Comma separated.
-output-file           Enable logging to file.
-p string              Base URL to send PRIVATE data to ('nats://', 'http://' or 'noop', comma separated).
-record string         Enable recording commands to a file for debugging.</code></pre>
    </section>

    <section class="content-section">
      <h2>Troubleshooting</h2>
      <p>Running the client from the command line keeps the window open so you can see error messages.</p>
      <ul class="client-platform-list">
        <li><strong>Windows:</strong> Press <kbd>Win</kbd>+<kbd>R</kbd>, enter <code>"C:\Program Files\Albion Data Client\albiondata-client.exe"</code>, then view the output.</li>
        <li><strong>MacOS:</strong> Open Terminal (<kbd>Cmd</kbd>+<kbd>Space</kbd>, type <code>terminal</code>), run <code>/path/to/albiondata-client</code>, then view the output.</li>
        <li><strong>Linux:</strong> Open a terminal, run <code>/path/to/albiondata-client</code>, then view the output.</li>
      </ul>

      <h3>Client crashing — device/adapter errors</h3>
      <p>Errors such as “No such device exists”, “Error opening adapter: The system cannot find the device specified. (20)”, or “You don’t have permission to capture on that device” (Linux/MacOS) mean the client cannot attach to the network interface used by Albion Online.</p>
      <p><strong>Fix:</strong> Tell the client which adapter to use with the <code>-l</code> (lowercase L) option and your adapter’s physical (MAC) address.</p>
      <ul class="client-platform-list">
        <li><strong>Windows:</strong> Open a command prompt → run <code>ipconfig.exe /all</code> → find the adapter that gives you connectivity and note its <strong>Physical Address</strong>. Then start the client with <code>"C:\Program Files\Albion Data Client\albiondata-client.exe" -l "B4-2E-99-31-90-E2"</code> (use your address).</li>
        <li><strong>MacOS:</strong> Open a terminal → run <code>ifconfig</code> → find the adapter and its physical address. Start the client with <code>/path/to/albiondata-client -l "14:7D:DA:DB:C6:29"</code> (use your address).</li>
        <li><strong>Linux:</strong> Same as MacOS: <code>ifconfig</code>, find the physical address, then <code>/path/to/albiondata-client -l "7E-13-57-B4-C4-3B"</code> (use your address).</li>
      </ul>
      <p class="client-ref">Windows: the <strong>Physical Address</strong> appears in <code>ipconfig /all</code> output. Example:</p>
      <figure class="client-figure">
        <%= image_tag "client/ipconfig.png", alt: "ipconfig /all output showing Physical Address for the network adapter", class: "client-figure__img" %>
        <figcaption class="client-figure__caption">Finding Physical Address in <code>ipconfig /all</code> (Windows)</figcaption>
      </figure>
      <p class="client-ref">MacOS and Linux: run <code>ifconfig</code> and find the physical (MAC) address for your active adapter. Examples:</p>
      <div class="client-figures client-figures--two">
        <figure class="client-figure">
          <%= image_tag "macos-ifconfig.png", alt: "ifconfig output on MacOS showing physical address", class: "client-figure__img" %>
          <figcaption class="client-figure__caption"><code>ifconfig</code> (MacOS)</figcaption>
        </figure>
        <figure class="client-figure">
          <%= image_tag "linux-ifconfig.png", alt: "ifconfig output on Linux showing physical address", class: "client-figure__img" %>
          <figcaption class="client-figure__caption"><code>ifconfig</code> (Linux)</figcaption>
        </figure>
      </div>

      <h3>MacOS / Linux: need sudo</h3>
      <p>Running the client with <code>sudo</code> is the simplest option. To avoid full sudo, you can use a dedicated capture group (based on <a href="https://github.com/bettercap/bettercap/issues/783#issuecomment-1021912001" target="_blank" rel="noopener">this approach</a>). Replace <code>/path/to/albiondata-client</code> with the actual path to your client; <code>aod</code> = “Albion Online Data”.</p>
      <pre class="client-pre"><code># Add a capture group and add yourself to it
sudo groupadd aod
sudo usermod -a -G aod $USER

# Change the group of the client and set permissions
sudo chgrp aod /path/to/albiondata-client
sudo chmod 750 /path/to/albiondata-client</code></pre>
      <p class="client-ref">See also the <a href="https://github.com/regner/albiondata-client/issues/125" target="_blank" rel="noopener">original developer discussion</a>.</p>
    </section>

    <section class="content-section client-help-section">
      <h2>More help</h2>
      <p>For installation, errors (e.g. 902, 403), and other questions, see the <%= link_to "Client FAQ", client_faq_path %>.</p>
      <h3>Encryption</h3>
      <p>Client uploads use encryption. For technical details:</p>
      <figure class="client-figure">
        <%= image_tag "client-encryption.png", alt: "Client encryption overview", class: "client-figure__img" %>
        <figcaption class="client-figure__caption">Client encryption</figcaption>
      </figure>
    </section>
  </main>

  <footer class="site-footer">
    <p><%= link_to "The Albion Online Data Project", root_path %></p>
  </footer>
</div>
